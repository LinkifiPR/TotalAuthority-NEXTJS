module.exports=[47468,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(3130),e=a.i(54161),f=a.i(40695),g=a.i(5522),h=a.i(87682),i=a.i(88237),j=a.i(65733),k=a.i(41130),l=a.i(77687),m=a.i(59476),n=a.i(82043),o=a.i(14727),p=a.i(46842),q=a.i(92258),r=a.i(41675),s=a.i(3314),t=a.i(87532),u=a.i(81464),v=a.i(73320),w=a.i(4720),x=a.i(81560),y=a.i(15618),z=a.i(16201);a.s(["default",0,()=>{let[a,A]=(0,c.useState)([]),[B,C]=(0,c.useState)([]),[D,E]=(0,c.useState)(!0),[F,G]=(0,c.useState)(""),[H,I]=(0,c.useState)("all"),[J,K]=(0,c.useState)("all"),[L,M]=(0,c.useState)("date"),[N,O]=(0,c.useState)("desc"),[P,Q]=(0,c.useState)(null),[R,S]=(0,c.useState)(!1),[T,U]=(0,c.useState)(!1),[V,W]=(0,c.useState)("upload"),{toast:X}=(0,l.useToast)();(0,c.useEffect)(()=>{Y()},[]),(0,c.useEffect)(()=>{$()},[a,F,H,J,L,N]);let Y=async()=>{try{console.log("Fetching user details via admin-stats function...");let a=await fetch("https://pgbcixncaeyjunwxrsik.supabase.co/functions/v1/admin-stats?users=true",{method:"GET",headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBnYmNpeG5jYWV5anVud3hyc2lrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAwOTgzMDMsImV4cCI6MjA2NTY3NDMwM30.TUsBYptM7RIcVWZ0IQiGGNViSnlxr8ruN_zwiAup5Fc","Content-Type":"application/json"}});if(!a.ok)throw Error(`HTTP error! status: ${a.status}`);let b=await a.json();if(b.error)throw Error(b.error);A(b.users||[]),await Z(b.users||[])}catch(a){console.error("Error fetching users:",a),X({title:"Error",description:"Failed to fetch users",variant:"destructive"})}finally{E(!1)}},Z=async a=>{try{let{data:b,error:c}=await k.supabase.from("audit_reports").select("*").contains("audit_data",{type:"uploaded_pdf"});if(c)throw c;let d=a.map(a=>{let c=(b||[]).filter(b=>{let c=b.audit_data;return c?.uploaded_for_user===a.id});return{...a,paidAudits:c}});A(d)}catch(a){console.error("Error fetching paid audits:",a)}},$=()=>{let b=a.filter(a=>{let b=a.full_name?.toLowerCase().includes(F.toLowerCase())||a.email?.toLowerCase().includes(F.toLowerCase()),c="all"===H||a.role===H,d=!0;return"with-audits"===J?d=!!(a.paidAudits&&a.paidAudits.length>0):"without-audits"===J&&(d=!a.paidAudits||0===a.paidAudits.length),b&&c&&d});b.sort((a,b)=>{let c,d;switch(L){case"name":c=a.full_name||"",d=b.full_name||"";break;case"email":c=a.email||"",d=b.email||"";break;case"role":c=a.role||"",d=b.role||"";break;default:c=new Date(a.created_at).getTime(),d=new Date(b.created_at).getTime()}return"asc"===N?c>d?1:-1:c<d?1:-1}),C(b)},_=async a=>{let b=a.target.files?.[0];if(b&&P){if("application/pdf"!==b.type)return void X({title:"Invalid file type",description:"Please upload a PDF file only.",variant:"destructive"});U(!0);try{let a=`user-${P.id}-audit-${Date.now()}.pdf`,{data:c,error:d}=await k.supabase.storage.from("blog-media").upload(`audit-reports/${a}`,b);if(d)throw d;let{error:e}=await k.supabase.from("audit_reports").insert({client_name:P.full_name||P.email,share_url_slug:`user-${P.id}-${Date.now()}`,audit_data:{type:"uploaded_pdf",file_path:c.path,uploaded_for_user:P.id,uploaded_at:new Date().toISOString()},status:"active"});if(e)throw e;X({title:"PDF uploaded successfully",description:`Audit report has been added to ${P.full_name||P.email}'s dashboard.`}),S(!1),Q(null),Y()}catch(a){console.error("Error uploading PDF:",a),X({title:"Upload failed",description:a.message,variant:"destructive"})}finally{U(!1)}}},aa=async a=>{try{let{error:b}=await k.supabase.from("audit_reports").update({status:"archived"}).eq("id",a);if(b)throw b;X({title:"Audit removed successfully",description:"The audit has been archived and removed from the user's dashboard."}),S(!1),Q(null),Y()}catch(a){console.error("Error removing audit:",a),X({title:"Failed to remove audit",description:a.message,variant:"destructive"})}},ab=(a,b)=>{Q(a),W(b),S(!0)};return D?(0,b.jsxs)(o.SidebarProvider,{children:[(0,b.jsx)(m.AdminSidebar,{}),(0,b.jsxs)(o.SidebarInset,{children:[(0,b.jsx)(n.AdminHeader,{}),(0,b.jsx)("div",{className:"flex-1 p-8 pt-6",children:(0,b.jsx)("div",{className:"text-center py-8",children:"Loading users..."})})]})]}):(0,b.jsxs)(o.SidebarProvider,{children:[(0,b.jsx)(m.AdminSidebar,{}),(0,b.jsxs)(o.SidebarInset,{children:[(0,b.jsx)(n.AdminHeader,{}),(0,b.jsxs)("div",{className:"flex-1 space-y-4 p-8 pt-6",children:[(0,b.jsx)("div",{className:"flex items-center justify-between space-y-2",children:(0,b.jsx)("h2",{className:"text-3xl font-bold tracking-tight",children:"Users"})}),(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{children:"User Management"}),(0,b.jsxs)(d.CardDescription,{children:["Search, filter, and manage all registered users (",B.length," of ",a.length," total)"]})]}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(t.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,b.jsx)(g.Input,{placeholder:"Search users by name or email...",value:F,onChange:a=>G(a.target.value),className:"pl-10"})]})}),(0,b.jsxs)(h.Select,{value:H,onValueChange:I,children:[(0,b.jsxs)(h.SelectTrigger,{className:"w-full md:w-48",children:[(0,b.jsx)(u.Filter,{className:"h-4 w-4 mr-2"}),(0,b.jsx)(h.SelectValue,{placeholder:"Filter by role"})]}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"all",children:"All Roles"}),(0,b.jsx)(h.SelectItem,{value:"admin",children:"Admin"}),(0,b.jsx)(h.SelectItem,{value:"user",children:"User"})]})]}),(0,b.jsxs)(h.Select,{value:J,onValueChange:K,children:[(0,b.jsxs)(h.SelectTrigger,{className:"w-full md:w-48",children:[(0,b.jsx)(w.FileText,{className:"h-4 w-4 mr-2"}),(0,b.jsx)(h.SelectValue,{placeholder:"Filter by audits"})]}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"all",children:"All Users"}),(0,b.jsx)(h.SelectItem,{value:"with-audits",children:"With Paid Audits"}),(0,b.jsx)(h.SelectItem,{value:"without-audits",children:"Without Paid Audits"})]})]}),(0,b.jsxs)(h.Select,{value:`${L}-${N}`,onValueChange:a=>{let[b,c]=a.split("-");M(b),O(c)},children:[(0,b.jsx)(h.SelectTrigger,{className:"w-full md:w-48",children:(0,b.jsx)(h.SelectValue,{placeholder:"Sort by"})}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"date-desc",children:"Newest First"}),(0,b.jsx)(h.SelectItem,{value:"date-asc",children:"Oldest First"}),(0,b.jsx)(h.SelectItem,{value:"name-asc",children:"Name A-Z"}),(0,b.jsx)(h.SelectItem,{value:"name-desc",children:"Name Z-A"}),(0,b.jsx)(h.SelectItem,{value:"email-asc",children:"Email A-Z"}),(0,b.jsx)(h.SelectItem,{value:"email-desc",children:"Email Z-A"}),(0,b.jsx)(h.SelectItem,{value:"role-asc",children:"Role A-Z"}),(0,b.jsx)(h.SelectItem,{value:"role-desc",children:"Role Z-A"})]})]})]}),0===B.length?(0,b.jsx)("div",{className:"text-center py-8 text-gray-500",children:0===a.length?"No users found.":"No users match your search criteria."}):(0,b.jsx)("div",{className:"rounded-md border",children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{children:"User"}),(0,b.jsx)(i.TableHead,{children:"Email"}),(0,b.jsx)(i.TableHead,{children:"Role"}),(0,b.jsx)(i.TableHead,{children:"Joined"}),(0,b.jsx)(i.TableHead,{children:"Actions"})]})}),(0,b.jsx)(i.TableBody,{children:B.map(a=>(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)("div",{className:"p-2 bg-blue-100 rounded-full",children:(0,b.jsx)(p.User,{className:"w-4 h-4 text-blue-600"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:a.full_name||"No name provided"}),(0,b.jsxs)("div",{className:"text-sm text-gray-500",children:["ID: ",a.id.slice(0,8),"..."]})]})]})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(q.Mail,{className:"w-3 h-3 text-gray-400"}),(0,b.jsx)("span",{children:a.email})]})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)(e.Badge,{variant:"admin"===a.role?"default":"secondary",className:"flex items-center space-x-1 w-fit",children:[(0,b.jsx)(s.Shield,{className:"w-3 h-3"}),(0,b.jsx)("span",{children:a.role})]})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,b.jsx)(r.Calendar,{className:"w-3 h-3 text-gray-400"}),(0,b.jsx)("span",{children:new Date(a.created_at).toLocaleDateString()})]})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)("div",{className:"flex flex-col space-y-2",children:a.paidAudits&&a.paidAudits.length>0?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-green-600",children:[(0,b.jsx)(z.CheckCircle,{className:"w-4 h-4"}),(0,b.jsxs)("span",{children:[a.paidAudits.length," Paid Audit",a.paidAudits.length>1?"s":""]})]}),(0,b.jsxs)("div",{className:"flex space-x-1",children:[(0,b.jsxs)(f.Button,{size:"sm",variant:"outline",onClick:()=>ab(a,"manage"),className:"flex items-center space-x-1 text-xs px-2 py-1",children:[(0,b.jsx)(w.FileText,{className:"w-3 h-3"}),(0,b.jsx)("span",{children:"Manage"})]}),(0,b.jsxs)(f.Button,{size:"sm",variant:"outline",onClick:()=>ab(a,"upload"),className:"flex items-center space-x-1 text-xs px-2 py-1",children:[(0,b.jsx)(y.Plus,{className:"w-3 h-3"}),(0,b.jsx)("span",{children:"Add More"})]})]})]}):(0,b.jsxs)(f.Button,{size:"sm",variant:"outline",onClick:()=>ab(a,"upload"),className:"flex items-center space-x-1",children:[(0,b.jsx)(v.Upload,{className:"w-3 h-3"}),(0,b.jsx)("span",{children:"Upload to Paid Audit"})]})})})]},a.id))})]})})]})]}),(0,b.jsx)(j.Dialog,{open:R,onOpenChange:S,children:(0,b.jsxs)(j.DialogContent,{className:"max-w-2xl",children:[(0,b.jsxs)(j.DialogHeader,{children:[(0,b.jsx)(j.DialogTitle,{children:"upload"===V?"Upload Paid Audit Report PDF":"Manage Paid Audits"}),(0,b.jsx)(j.DialogDescription,{children:"upload"===V?`Upload a PDF audit report for ${P?.full_name||P?.email}. This will appear in their Paid Audit module on their dashboard.`:`Manage existing paid audits for ${P?.full_name||P?.email}.`})]}),"manage"===V&&P?.paidAudits&&P.paidAudits.length>0&&(0,b.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,b.jsx)("h4",{className:"font-medium text-sm text-gray-700",children:"Existing Audits:"}),(0,b.jsx)("div",{className:"space-y-2",children:P.paidAudits.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-sm",children:a.client_name}),(0,b.jsxs)("p",{className:"text-xs text-gray-500",children:["Uploaded: ",new Date(a.created_at).toLocaleDateString()]})]}),(0,b.jsxs)(f.Button,{size:"sm",variant:"destructive",onClick:()=>aa(a.id),className:"flex items-center space-x-1",children:[(0,b.jsx)(x.Trash2,{className:"w-3 h-3"}),(0,b.jsx)("span",{children:"Remove"})]})]},a.id))})]}),("upload"===V||"manage"===V)&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h4",{className:"font-medium text-sm text-gray-700",children:"manage"===V?"Upload Additional Audit:":"Upload New Audit:"}),(0,b.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-400 transition-colors",children:[(0,b.jsx)(w.FileText,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,b.jsx)("div",{className:"text-sm text-gray-600 mb-4",children:"Click to select PDF file or drag and drop"}),(0,b.jsx)("input",{id:"pdf-upload",type:"file",accept:".pdf",onChange:_,className:"hidden",disabled:T}),(0,b.jsx)(f.Button,{variant:"outline",disabled:T,onClick:()=>document.getElementById("pdf-upload")?.click(),className:"hover:bg-blue-50",children:T?"Uploading...":"Choose PDF File"})]})]})]})})]})]})]})}])}];

//# sourceMappingURL=app_admin_users_page_tsx_4f85054f._.js.map