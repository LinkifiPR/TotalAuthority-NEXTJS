(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,98919,e=>{"use strict";let a=(0,e.i(75254).default)("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);e.s(["Shield",()=>a],98919)},63488,e=>{"use strict";let a=(0,e.i(75254).default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);e.s(["Mail",()=>a],63488)},55436,e=>{"use strict";let a=(0,e.i(75254).default)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);e.s(["Search",()=>a],55436)},69638,e=>{"use strict";let a=(0,e.i(75254).default)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>a],69638)},97548,e=>{"use strict";let a=(0,e.i(75254).default)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);e.s(["Filter",()=>a],97548)},47627,e=>{"use strict";var a=e.i(43476),t=e.i(71645),s=e.i(47163);let l=t.forwardRef(({className:e,...t},l)=>(0,a.jsx)("div",{className:"relative w-full overflow-auto",children:(0,a.jsx)("table",{ref:l,className:(0,s.cn)("w-full caption-bottom text-sm",e),...t})}));l.displayName="Table";let i=t.forwardRef(({className:e,...t},l)=>(0,a.jsx)("thead",{ref:l,className:(0,s.cn)("[&_tr]:border-b",e),...t}));i.displayName="TableHeader";let r=t.forwardRef(({className:e,...t},l)=>(0,a.jsx)("tbody",{ref:l,className:(0,s.cn)("[&_tr:last-child]:border-0",e),...t}));r.displayName="TableBody",t.forwardRef(({className:e,...t},l)=>(0,a.jsx)("tfoot",{ref:l,className:(0,s.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t})).displayName="TableFooter";let d=t.forwardRef(({className:e,...t},l)=>(0,a.jsx)("tr",{ref:l,className:(0,s.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t}));d.displayName="TableRow";let n=t.forwardRef(({className:e,...t},l)=>(0,a.jsx)("th",{ref:l,className:(0,s.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));n.displayName="TableHead";let c=t.forwardRef(({className:e,...t},l)=>(0,a.jsx)("td",{ref:l,className:(0,s.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));c.displayName="TableCell",t.forwardRef(({className:e,...t},l)=>(0,a.jsx)("caption",{ref:l,className:(0,s.cn)("mt-4 text-sm text-muted-foreground",e),...t})).displayName="TableCaption",e.s(["Table",()=>l,"TableBody",()=>r,"TableCell",()=>c,"TableHead",()=>n,"TableHeader",()=>i,"TableRow",()=>d])},30374,e=>{"use strict";var a=e.i(43476),t=e.i(71645),s=e.i(26999),l=e.i(37727),i=e.i(47163);let r=s.Root,d=s.Trigger,n=s.Portal;s.Close;let c=t.forwardRef(({className:e,...t},l)=>(0,a.jsx)(s.Overlay,{ref:l,className:(0,i.cn)("fixed inset-0 z-[10000] bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));c.displayName=s.Overlay.displayName;let o=t.forwardRef(({className:e,children:t,...r},d)=>(0,a.jsxs)(n,{children:[(0,a.jsx)(c,{}),(0,a.jsxs)(s.Content,{ref:d,className:(0,i.cn)("fixed left-[50%] top-[50%] z-[10001] grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...r,children:[t,(0,a.jsxs)(s.Close,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(l.X,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]}));o.displayName=s.Content.displayName;let u=({className:e,...t})=>(0,a.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});u.displayName="DialogHeader";let m=t.forwardRef(({className:e,...t},l)=>(0,a.jsx)(s.Title,{ref:l,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",e),...t}));m.displayName=s.Title.displayName;let x=t.forwardRef(({className:e,...t},l)=>(0,a.jsx)(s.Description,{ref:l,className:(0,i.cn)("text-sm text-muted-foreground",e),...t}));x.displayName=s.Description.displayName,e.s(["Dialog",()=>r,"DialogContent",()=>o,"DialogDescription",()=>x,"DialogHeader",()=>u,"DialogTitle",()=>m,"DialogTrigger",()=>d])},7233,e=>{"use strict";let a=(0,e.i(75254).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>a],7233)},69074,e=>{"use strict";let a=(0,e.i(75254).default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);e.s(["Upload",()=>a],69074)},51364,e=>{"use strict";var a=e.i(43476),t=e.i(71645),s=e.i(70065),l=e.i(94179),i=e.i(67881),r=e.i(23750),d=e.i(62870),n=e.i(47627),c=e.i(30374),o=e.i(91386),u=e.i(20682),m=e.i(18462),x=e.i(39412),h=e.i(11522),p=e.i(84614),f=e.i(63488),j=e.i(87316),g=e.i(98919),b=e.i(55436),y=e.i(97548),N=e.i(69074),v=e.i(78583),w=e.i(27612),S=e.i(7233),T=e.i(69638);e.s(["default",0,()=>{let[e,C]=(0,t.useState)([]),[A,I]=(0,t.useState)([]),[k,D]=(0,t.useState)(!0),[_,R]=(0,t.useState)(""),[F,P]=(0,t.useState)("all"),[U,M]=(0,t.useState)("all"),[H,B]=(0,t.useState)("date"),[z,E]=(0,t.useState)("desc"),[V,O]=(0,t.useState)(null),[$,L]=(0,t.useState)(!1),[Z,J]=(0,t.useState)(!1),[Y,G]=(0,t.useState)("upload"),{toast:W}=(0,u.useToast)();(0,t.useEffect)(()=>{X()},[]),(0,t.useEffect)(()=>{K()},[e,_,F,U,H,z]);let X=async()=>{try{console.log("Fetching user details via admin-stats function...");let e=await fetch("https://pgbcixncaeyjunwxrsik.supabase.co/functions/v1/admin-stats?users=true",{method:"GET",headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBnYmNpeG5jYWV5anVud3hyc2lrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAwOTgzMDMsImV4cCI6MjA2NTY3NDMwM30.TUsBYptM7RIcVWZ0IQiGGNViSnlxr8ruN_zwiAup5Fc","Content-Type":"application/json"}});if(!e.ok)throw Error(`HTTP error! status: ${e.status}`);let a=await e.json();if(a.error)throw Error(a.error);C(a.users||[]),await q(a.users||[])}catch(e){console.error("Error fetching users:",e),W({title:"Error",description:"Failed to fetch users",variant:"destructive"})}finally{D(!1)}},q=async e=>{try{let{data:a,error:t}=await o.supabase.from("audit_reports").select("*").contains("audit_data",{type:"uploaded_pdf"});if(t)throw t;let s=e.map(e=>{let t=(a||[]).filter(a=>{let t=a.audit_data;return t?.uploaded_for_user===e.id});return{...e,paidAudits:t}});C(s)}catch(e){console.error("Error fetching paid audits:",e)}},K=()=>{let a=e.filter(e=>{let a=e.full_name?.toLowerCase().includes(_.toLowerCase())||e.email?.toLowerCase().includes(_.toLowerCase()),t="all"===F||e.role===F,s=!0;return"with-audits"===U?s=!!(e.paidAudits&&e.paidAudits.length>0):"without-audits"===U&&(s=!e.paidAudits||0===e.paidAudits.length),a&&t&&s});a.sort((e,a)=>{let t,s;switch(H){case"name":t=e.full_name||"",s=a.full_name||"";break;case"email":t=e.email||"",s=a.email||"";break;case"role":t=e.role||"",s=a.role||"";break;default:t=new Date(e.created_at).getTime(),s=new Date(a.created_at).getTime()}return"asc"===z?t>s?1:-1:t<s?1:-1}),I(a)},Q=async e=>{let a=e.target.files?.[0];if(a&&V){if("application/pdf"!==a.type)return void W({title:"Invalid file type",description:"Please upload a PDF file only.",variant:"destructive"});J(!0);try{let e=`user-${V.id}-audit-${Date.now()}.pdf`,{data:t,error:s}=await o.supabase.storage.from("blog-media").upload(`audit-reports/${e}`,a);if(s)throw s;let{error:l}=await o.supabase.from("audit_reports").insert({client_name:V.full_name||V.email,share_url_slug:`user-${V.id}-${Date.now()}`,audit_data:{type:"uploaded_pdf",file_path:t.path,uploaded_for_user:V.id,uploaded_at:new Date().toISOString()},status:"active"});if(l)throw l;W({title:"PDF uploaded successfully",description:`Audit report has been added to ${V.full_name||V.email}'s dashboard.`}),L(!1),O(null),X()}catch(e){console.error("Error uploading PDF:",e),W({title:"Upload failed",description:e.message,variant:"destructive"})}finally{J(!1)}}},ee=async e=>{try{let{error:a}=await o.supabase.from("audit_reports").update({status:"archived"}).eq("id",e);if(a)throw a;W({title:"Audit removed successfully",description:"The audit has been archived and removed from the user's dashboard."}),L(!1),O(null),X()}catch(e){console.error("Error removing audit:",e),W({title:"Failed to remove audit",description:e.message,variant:"destructive"})}},ea=(e,a)=>{O(e),G(a),L(!0)};return k?(0,a.jsxs)(h.SidebarProvider,{children:[(0,a.jsx)(m.AdminSidebar,{}),(0,a.jsxs)(h.SidebarInset,{children:[(0,a.jsx)(x.AdminHeader,{}),(0,a.jsx)("div",{className:"flex-1 p-8 pt-6",children:(0,a.jsx)("div",{className:"text-center py-8",children:"Loading users..."})})]})]}):(0,a.jsxs)(h.SidebarProvider,{children:[(0,a.jsx)(m.AdminSidebar,{}),(0,a.jsxs)(h.SidebarInset,{children:[(0,a.jsx)(x.AdminHeader,{}),(0,a.jsxs)("div",{className:"flex-1 space-y-4 p-8 pt-6",children:[(0,a.jsx)("div",{className:"flex items-center justify-between space-y-2",children:(0,a.jsx)("h2",{className:"text-3xl font-bold tracking-tight",children:"Users"})}),(0,a.jsxs)(s.Card,{children:[(0,a.jsxs)(s.CardHeader,{children:[(0,a.jsx)(s.CardTitle,{children:"User Management"}),(0,a.jsxs)(s.CardDescription,{children:["Search, filter, and manage all registered users (",A.length," of ",e.length," total)"]})]}),(0,a.jsxs)(s.CardContent,{children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(b.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,a.jsx)(r.Input,{placeholder:"Search users by name or email...",value:_,onChange:e=>R(e.target.value),className:"pl-10"})]})}),(0,a.jsxs)(d.Select,{value:F,onValueChange:P,children:[(0,a.jsxs)(d.SelectTrigger,{className:"w-full md:w-48",children:[(0,a.jsx)(y.Filter,{className:"h-4 w-4 mr-2"}),(0,a.jsx)(d.SelectValue,{placeholder:"Filter by role"})]}),(0,a.jsxs)(d.SelectContent,{children:[(0,a.jsx)(d.SelectItem,{value:"all",children:"All Roles"}),(0,a.jsx)(d.SelectItem,{value:"admin",children:"Admin"}),(0,a.jsx)(d.SelectItem,{value:"user",children:"User"})]})]}),(0,a.jsxs)(d.Select,{value:U,onValueChange:M,children:[(0,a.jsxs)(d.SelectTrigger,{className:"w-full md:w-48",children:[(0,a.jsx)(v.FileText,{className:"h-4 w-4 mr-2"}),(0,a.jsx)(d.SelectValue,{placeholder:"Filter by audits"})]}),(0,a.jsxs)(d.SelectContent,{children:[(0,a.jsx)(d.SelectItem,{value:"all",children:"All Users"}),(0,a.jsx)(d.SelectItem,{value:"with-audits",children:"With Paid Audits"}),(0,a.jsx)(d.SelectItem,{value:"without-audits",children:"Without Paid Audits"})]})]}),(0,a.jsxs)(d.Select,{value:`${H}-${z}`,onValueChange:e=>{let[a,t]=e.split("-");B(a),E(t)},children:[(0,a.jsx)(d.SelectTrigger,{className:"w-full md:w-48",children:(0,a.jsx)(d.SelectValue,{placeholder:"Sort by"})}),(0,a.jsxs)(d.SelectContent,{children:[(0,a.jsx)(d.SelectItem,{value:"date-desc",children:"Newest First"}),(0,a.jsx)(d.SelectItem,{value:"date-asc",children:"Oldest First"}),(0,a.jsx)(d.SelectItem,{value:"name-asc",children:"Name A-Z"}),(0,a.jsx)(d.SelectItem,{value:"name-desc",children:"Name Z-A"}),(0,a.jsx)(d.SelectItem,{value:"email-asc",children:"Email A-Z"}),(0,a.jsx)(d.SelectItem,{value:"email-desc",children:"Email Z-A"}),(0,a.jsx)(d.SelectItem,{value:"role-asc",children:"Role A-Z"}),(0,a.jsx)(d.SelectItem,{value:"role-desc",children:"Role Z-A"})]})]})]}),0===A.length?(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:0===e.length?"No users found.":"No users match your search criteria."}):(0,a.jsx)("div",{className:"rounded-md border",children:(0,a.jsxs)(n.Table,{children:[(0,a.jsx)(n.TableHeader,{children:(0,a.jsxs)(n.TableRow,{children:[(0,a.jsx)(n.TableHead,{children:"User"}),(0,a.jsx)(n.TableHead,{children:"Email"}),(0,a.jsx)(n.TableHead,{children:"Role"}),(0,a.jsx)(n.TableHead,{children:"Joined"}),(0,a.jsx)(n.TableHead,{children:"Actions"})]})}),(0,a.jsx)(n.TableBody,{children:A.map(e=>(0,a.jsxs)(n.TableRow,{children:[(0,a.jsx)(n.TableCell,{children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-100 rounded-full",children:(0,a.jsx)(p.User,{className:"w-4 h-4 text-blue-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:e.full_name||"No name provided"}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["ID: ",e.id.slice(0,8),"..."]})]})]})}),(0,a.jsx)(n.TableCell,{children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(f.Mail,{className:"w-3 h-3 text-gray-400"}),(0,a.jsx)("span",{children:e.email})]})}),(0,a.jsx)(n.TableCell,{children:(0,a.jsxs)(l.Badge,{variant:"admin"===e.role?"default":"secondary",className:"flex items-center space-x-1 w-fit",children:[(0,a.jsx)(g.Shield,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:e.role})]})}),(0,a.jsx)(n.TableCell,{children:(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,a.jsx)(j.Calendar,{className:"w-3 h-3 text-gray-400"}),(0,a.jsx)("span",{children:new Date(e.created_at).toLocaleDateString()})]})}),(0,a.jsx)(n.TableCell,{children:(0,a.jsx)("div",{className:"flex flex-col space-y-2",children:e.paidAudits&&e.paidAudits.length>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-green-600",children:[(0,a.jsx)(T.CheckCircle,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:[e.paidAudits.length," Paid Audit",e.paidAudits.length>1?"s":""]})]}),(0,a.jsxs)("div",{className:"flex space-x-1",children:[(0,a.jsxs)(i.Button,{size:"sm",variant:"outline",onClick:()=>ea(e,"manage"),className:"flex items-center space-x-1 text-xs px-2 py-1",children:[(0,a.jsx)(v.FileText,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:"Manage"})]}),(0,a.jsxs)(i.Button,{size:"sm",variant:"outline",onClick:()=>ea(e,"upload"),className:"flex items-center space-x-1 text-xs px-2 py-1",children:[(0,a.jsx)(S.Plus,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:"Add More"})]})]})]}):(0,a.jsxs)(i.Button,{size:"sm",variant:"outline",onClick:()=>ea(e,"upload"),className:"flex items-center space-x-1",children:[(0,a.jsx)(N.Upload,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:"Upload to Paid Audit"})]})})})]},e.id))})]})})]})]}),(0,a.jsx)(c.Dialog,{open:$,onOpenChange:L,children:(0,a.jsxs)(c.DialogContent,{className:"max-w-2xl",children:[(0,a.jsxs)(c.DialogHeader,{children:[(0,a.jsx)(c.DialogTitle,{children:"upload"===Y?"Upload Paid Audit Report PDF":"Manage Paid Audits"}),(0,a.jsx)(c.DialogDescription,{children:"upload"===Y?`Upload a PDF audit report for ${V?.full_name||V?.email}. This will appear in their Paid Audit module on their dashboard.`:`Manage existing paid audits for ${V?.full_name||V?.email}.`})]}),"manage"===Y&&V?.paidAudits&&V.paidAudits.length>0&&(0,a.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,a.jsx)("h4",{className:"font-medium text-sm text-gray-700",children:"Existing Audits:"}),(0,a.jsx)("div",{className:"space-y-2",children:V.paidAudits.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-sm",children:e.client_name}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["Uploaded: ",new Date(e.created_at).toLocaleDateString()]})]}),(0,a.jsxs)(i.Button,{size:"sm",variant:"destructive",onClick:()=>ee(e.id),className:"flex items-center space-x-1",children:[(0,a.jsx)(w.Trash2,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:"Remove"})]})]},e.id))})]}),("upload"===Y||"manage"===Y)&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"font-medium text-sm text-gray-700",children:"manage"===Y?"Upload Additional Audit:":"Upload New Audit:"}),(0,a.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-400 transition-colors",children:[(0,a.jsx)(v.FileText,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("div",{className:"text-sm text-gray-600 mb-4",children:"Click to select PDF file or drag and drop"}),(0,a.jsx)("input",{id:"pdf-upload",type:"file",accept:".pdf",onChange:Q,className:"hidden",disabled:Z}),(0,a.jsx)(i.Button,{variant:"outline",disabled:Z,onClick:()=>document.getElementById("pdf-upload")?.click(),className:"hover:bg-blue-50",children:Z?"Uploading...":"Choose PDF File"})]})]})]})})]})]})]})}])}]);